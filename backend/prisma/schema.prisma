// This is a simplified Prisma schema file for Upzento CRM deployment
// Learn more about Prisma: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Core models for multi-tenancy

model Tenant {
  id          String    @id @default(uuid())
  name        String
  domain      String?   @unique
  plan        String    @default("free")
  status      String    @default("active")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relationships
  agencies    Agency[]
  users       User[]
}

model Agency {
  id          String    @id @default(uuid())
  name        String
  logo        String?
  primaryColor String?
  tenantId    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relationships
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  clients     Client[]
  users       User[]
}

model Client {
  id          String    @id @default(uuid())
  name        String
  logo        String?
  primaryColor String?
  agencyId    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relationships
  agency      Agency    @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  users       User[]
}

// User management model

model User {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String
  firstName   String
  lastName    String
  role        Role      @default(CLIENT_USER)
  tenantId    String?
  agencyId    String?
  clientId    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relationships
  tenant      Tenant?   @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  agency      Agency?   @relation(fields: [agencyId], references: [id], onDelete: SetNull)
  client      Client?   @relation(fields: [clientId], references: [id], onDelete: SetNull)
}

// Enums
enum Role {
  SUPER_ADMIN
  ADMIN
  AGENCY_OWNER
  AGENCY_ADMIN
  AGENCY_USER
  CLIENT_OWNER
  CLIENT_ADMIN
  CLIENT_USER
}
